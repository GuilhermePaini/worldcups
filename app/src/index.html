<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.10/dist/vue.js"></script>

    <title>World Cups API</title>
</head>

<body id="grad">
    <div id="app" class="container mx-auto my-3">
        <h1 class="text-3xl font-bold underline">
            FIFA Worldcups
        </h1>
        <hr />

        <!--GET /worldcups/:year -->

        <div class="mb-3 row">
            <label for="year" class="col-sm-2 col-form-label">Digite o ano da copa: </label>
            <div class="col-sm-9">
                <input type="number" class="form-control" v-model="year_cup" id="year" placeholder="ano da copa">
            </div>
            <button class="col-sm-1 btn btn-primary" @click="search(year_cup)">Pesquisar</button>
        </div>
        <div class="mb-3" v-if="year_info != null">
            <p><b>Sede: </b>{{year_info.Country}}</p>
            <p><b>Vencedor: </b>{{year_info.Winner}}</p>
            <p><b>Segundo lugar: </b>{{year_info.RunnersUp}}</p>
        </div>

        <!--GET /worldcups/finals/:year-->

        <div class="mb-3 row">
            <label for="year" class="col-sm-2 col-form-label">Digite o ano da copa: </label>
            <div class="col-sm-9">
                <input type="number" class="form-control" v-model="finals_cup" id="year" placeholder="ano da copa">
            </div>
            <button class="col-sm-1 btn btn-primary" @click="searchFinals(finals_cup)">Pesquisar</button>
        </div>
        <div class="mb-3" v-if="finals_info != null">
            <p><b>Data da final: </b>{{finals_info.Datetime}}</p>
            <p><b>Estádio da final: </b>{{finals_info.Stadium}}</p>
            <p><b>Times na final: </b>{{finals_info.Home_Team_Name}}<b> X </b>{{finals_info.Away_Team_Name}}</p>
            <p><b>Gols na final: </b>{{finals_info.Home_Team_Goals}}<b> X </b>{{finals_info.Away_Team_Goals}}</p>
            <p><b>Condições da partida: </b>{{finals_info.Win_conditions}}</p>
        </div>

        <!--GET /worldcups/country/:country-->

        <div class="mb-3 row">
            <label for="year" class="col-sm-2 col-form-label">Digite o país: </label>
            <div class="col-sm-9">
                <input type="text" class="form-control" v-model="countries_cup" id="year" placeholder="nome do país">
            </div>
            <button class="col-sm-1 btn btn-primary" @click="searchCountries(countries_cup)">Pesquisar</button>
        </div>
        <div class="mb-3" v-if="countries_info != null">
            <template v-for="country in countries_info">
                <p><b>Ano: </b>{{country.Year}}</p>
                <p><b>Sede: </b>{{country.Country}}</p>
                <p><b>Colocação: </b>{{country.Position}}</p>
            </template>
        </div>

        <!--GET /worldcups/details/:year-->

        <div class="mb-3 row">
            <label for="year" class="col-sm-2 col-form-label">Digite o ano da copa: </label>
            <div class="col-sm-9">
                <input type="number" class="form-control" v-model="details" id="year" placeholder="ano da copa">
            </div>
            <button class="col-sm-1 btn btn-primary" @click="searchDetails(details)">Pesquisar</button>
        </div>
        <div class="mb-3" v-if="details_info != null">
            <p><b>Sede: </b>{{details_info.Country}}</p>
            <p><b>Vencedor: </b>{{details_info.Winner}}</p>
            <p><b>Segundo lugar: </b>{{details_info.RunnersUp}}</p>
            <p><b>Data da final: </b>{{details_info.Datetime}}</p>
            <p><b>Estádio da final: </b>{{details_info.Stadium}}</p>
            <p><b>Placar da final: </b>{{details_info.Home_Team_Goals}}<b> X </b>{{details_info.Away_Team_Goals}}</p>
        </div>

    </div>
</body>

</html>

<script>
    new Vue({
        el: '#app',
        data: {
            year_cup: 1930,
            year_info: null,
            finals_cup: 1930,
            finals_info: null,
            countries_cup: 'Argentina',
            countries_info: null,
            details: 1930,
            details_info: null,
        },

        methods: {
            async search(year_cup) {
                try {
                    fetch(`http://localhost:3000/worldcups/${year_cup}`)
                        .then(async (response) => {
                            this.year_info = await this.handleResponse(response)
                        })
                } catch (err) {
                    console.log(err);
                }
            },

            async searchFinals(finals_cup) {
                try {
                    fetch(`http://localhost:3000/worldcups/finals/${finals_cup}`)
                        .then(async (response) => {
                            this.finals_info = await this.handleResponse(response)
                        })
                } catch (err) {
                    console.log(err);
                }
            },

            async searchCountries(countries_cup) {
                try {
                    fetch(`http://localhost:3000/worldcups/country/${countries_cup}`)
                        .then(async (response) => {
                            this.countries_info = await this.handleResponse(response)
                        })
                } catch (err) {
                    console.log(err);
                }
            },

            async searchDetails(details) {
                try {
                    fetch(`http://localhost:3000/worldcups/details/${details}`)
                        .then(async (response) => {
                            this.details_info = await this.handleResponse(response)
                        })
                } catch (err) {
                    console.log(err);
                }
            },

            async handleResponse(response) {
                if (response.status > 400)
                    return null;
                if (response.status >= 200)
                    return await response.json();
            }
        },
        computed: {
        },
        mounted() {
            console.log("mounted");
        },
        created() {
            console.log("created");
        },
        beforeMount() {
            console.log("beforeMount");
        }
    })
</script>